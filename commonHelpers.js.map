{"version":3,"file":"commonHelpers.js","sources":["../src/js/modal-window.js","../src/js/cart-page.js"],"sourcesContent":["document.getElementById(\"open-modal-btn\").addEventListener(\"click\", openModal)\ndocument.getElementById(\"close-my-modal-btn\").addEventListener(\"click\", closeModal)\n\n// Відкрити модальне вікно\nfunction openModal(){\n    document.getElementById(\"my-modal\").classList.add(\"open\")\n}\n\n\n// Закрити модальне вікно\nfunction closeModal() {\n    document.getElementById(\"my-modal\").classList.remove(\"open\")\n}\n\n// Закрити модальне вікно на Esc\nwindow.addEventListener('keydown', (e) => {\n    if (e.key === \"Escape\") {\n        document.getElementById(\"my-modal\").classList.remove(\"open\")\n    }\n});\n\n// Закрити модальне вікно при кліку поза вікном \ndocument.querySelector(\"#my-modal .modal__box\").addEventListener('click', event => {\n    event._isClickWithInModal = true;\n});\ndocument.getElementById(\"my-modal\").addEventListener('click', event => {\n    if (event._isClickWithInModal) return;\n    event.currentTarget.classList.remove('open');\n});","import './header';\n\nimport icons from '../img/icone/symbol-defs.svg';\nimport { getCart, clearCart, saveCart } from './local-storage';\nimport axios from 'axios';\nimport { updateCartCount } from \"./local-storage\";\nimport './modal-window';\n\n\nconst BASE_URL = 'https://food-boutique.b.goit.study/api/orders ';\n\nconst orderForm = document.querySelector('.order-form');\nconst imageForModal = document.querySelector(\".image-container-modal-cart\");\nconst openCartModal = document.querySelector(\".order-btn-submit\");\nconst closeCartModal = document.querySelector(\".close-svg\");\nconst cartModal = document.querySelector(\".checkout-modal\");\n\nconst refs = {\n  cartProductList: document.querySelector('.js-cart-list'),\n  deleteAllBtn: document.querySelector('.js-delete-all-btn'),\n  emptyBasketContent: document.querySelector('.empty-basket-content'),\n  emptyBasketWrap: document.querySelector('.empty-basket-wrap'),\n  cartMainContainer: document.querySelector('.main-content-with-delete-all'),\n  numberOfProducts: document.querySelector('.js-number-of-products'),\n  cartTotalPrice: document.querySelector('.js-cart-amount'),\n  orderForm: document.querySelector('.order-form'),\n};\n\n\nrenderCartMarkup();\ngetNumberOfProducts();\nmodalImage();\n\nrefs.cartProductList.addEventListener('click', onClickDeleteProduct);\n\nfunction renderCartMarkup() {\n  const lsData = getCart();\n\n  if (!lsData.length) {\n    refs.emptyBasketContent.hidden = false;\n    return;\n  }\n\n  renderCartTpl(lsData);\n  refs.cartMainContainer.hidden = false;\n  refs.emptyBasketWrap.style.display = 'none';\n\n  countTotalPrice();\n  refs.orderForm.addEventListener('submit', onOrderFormSubmit);\n}\n\nfunction getNumberOfProducts() {\n  const lsData = getCart();\n  refs.numberOfProducts.textContent = lsData.length;\n}\n\nfunction onClickDeleteProduct(evt) {\n  if (!evt.target.classList.contains('js-delete-product-btn')) {\n    return;\n  }\n\n  const parent = evt.target.closest('.js-cart-item');\n  const productId = parent.dataset.id;\n\n  const productsCartInLS = getCart();\n  const findProduct = productsCartInLS.filter(({ _id }) => productId !== _id);\n\n  saveCart(findProduct);\n\n  parent.style.display = 'none';\n\n  getNumberOfProducts();\n\n  checkLS();\n  countTotalPrice();\n}\n\nfunction checkLS() {\n  const lsData = getCart();\n  if (!lsData.length) {\n    refs.cartMainContainer.hidden = true;\n\n    refs.emptyBasketContent.hidden = false;\n    refs.emptyBasketWrap.style.display = 'block';\n    refs.cartProductList.innerHTML = '';\n  }\n}\n\n// Розмітка cartProductList\nfunction renderCartTpl(arr) {\n  const markup = arr\n    .map(({ _id, name, img, category, price, size }) => {\n      const categoryWithoutUnderscore = category.split('_').join(' ');\n      return `<li class=\"cart-item js-cart-item\" data-id = ${_id}>\n       <span class=\"delete-product-btn js-delete-product-btn\">\n              <svg width=\"12\" height=\"12\" class='js-delete-product-btn'>\n                <use class='js-delete-product-btn' href=\"${icons}#close-button\"></use></svg\n            ></span>\n          <div class=\"cart-item-info-wrap\">\n            <div class=\"cart-img-wrap-bgc\">\n              <div class=\"cart-img-thumb\">\n              <img\n                src=\"${img}\"\n                alt=\"${name}\"\n                width=\"100\"\n                height=\"100\"\n              />\n              </div>\n            </div>\n            <div class=\"cart-item-descr\">\n              <h3 class=\"cart-item-title\">${name}</h3>\n              <div class=\"cart-text-wrap\">\n                <p class=\"cart-item-text\">\n                  <span class=\"cart-light-text\">Category:</span\n                  >&nbsp;&nbsp;${categoryWithoutUnderscore}\n                </p>\n                <p class=\"cart-item-text\">\n                  <span class=\"cart-light-text\">Size:</span>&nbsp;&nbsp;${size}\n                </p>\n              </div>\n              <p class=\"cart-item-price\">$${price}</p>\n            </div>\n          </div>\n        </li>`;\n    })\n    .join('');\n\n  return (refs.cartProductList.innerHTML = markup);\n}\n\n// Кнопка видалення усіх продуктів\nrefs.deleteAllBtn.addEventListener('click', deleteProducts)\n\nfunction deleteProducts() {\n  refs.cartProductList.innerHTML = '';\n  clearCart();\n  countTotalPrice();\n  getNumberOfProducts();\n  refs.cartMainContainer.hidden = true;\n  refs.emptyBasketContent.hidden = false;\n  refs.emptyBasketWrap.style.display = 'block';\n}\n\nfunction countTotalPrice() {\n  const lsData = getCart();\n\n  const totalPrice = lsData.reduce(\n    (acc, { price, quantity }) => (acc += price * quantity),\n    0\n  );\n  refs.cartTotalPrice.textContent = totalPrice.toFixed(2);\n  updateCartCount();\n}\n\n// ================================================\n\nasync function onOrderFormSubmit(evt) {\n  evt.preventDefault();\n  const email = evt.currentTarget.elements.email.value;\n\n  if (!email) {\n    alert('Please, write your email!');\n    return;\n  }\n  // postProductApi(email);\n  checkOnValidateEmail(email);\n  evt.currentTarget.reset();\n\n    //Відправляємо озамовлення на сервер\n  const productsInCart = getCart();\n  const productsData = productsInCart.map(({ _id }) => ({\n    productId: _id,\n    amount: 1,\n  }));\n\n  const orderData = {\n    email,\n    products: productsData,\n  };\ntry {\n  const response = await fetch('https://food-boutique.b.goit.study/api/orders', {\n      method: 'POST',\n      headers: {\n          'Content-Type': 'application/json',\n      },\n      body: JSON.stringify(orderData),\n  });\n\n  if (response.ok) {\n      clearCart();\n      deleteProducts()\n      updateCartCount()\n  } else if (response.status === 400) {\n    // Обробка помилок \"Bad Request\"\n    const errorData = await response.json();\n    alert('Bad request: ' + errorData.message);\n  } else if (response.status === 404) {\n    // Обробка помилок \"Not Found\"\n    alert('Resource not found.');\n  } else if (response.status === 500) {\n    // Обробка помилок \"Server Error\"\n    alert('Server error. Please try again later.');\n  } else {\n    // Інші невизначені помилки\n    throw new Error('Failed to subscribe.');\n}\n  } catch (error) {\n  alert('Error: ' + error.message);\n}\n}\n\n\nfunction checkOnValidateEmail(email) {\n  const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n  if (!emailRegex.test(email)) {\n    alert('Please, enter valid Email!');\n    return;\n  }\n}\n\n\n\n\n\n// // POST запит на API\n// async function postProductApi(email) {\n//   const [{ _id, quantity }] = getCart();\n\n//   const formData = {\n//     email: email,\n//     products: [{ productId: _id, amount: quantity }],\n//   };\n\n//   const options = {\n//     method: 'post',\n//     data: formData,\n//   };\n\n//   try {\n//     await axios(\n//       `${BASE_URL}\n// `,\n//       options\n//     );\n//     cartProductList.innerHTML = '';\n//     alert('Your order is accepted!');\n//   } catch (error) {\n//     console.error(error);\n//   }\n// }\n\ncloseCartModal.addEventListener(\"click\", function () {\n  cartModal.classList.remove(\"open\");\n})\n\nfunction modalImage() {\n  const arrayForImage = getCart();\n\n  // takeImage(arrayForImage);\n}\n\n// function takeImage(arr) {\n//   const images = arr.map(({ img, name }) => ({ img, name }));\n//   const randomIndex = Math.floor(Math.random() * images.length);\n//   const randomImage = images[randomIndex];\n//   const modalImg = `<img src=\"${randomImage.img}\" alt=\"${randomImage.name}\" width=\"140\" height=\"140\">`;\n\n//   imageForModal.insertAdjacentHTML('beforeend', modalImg);\n// }\n"],"names":["openModal","closeModal","e","event","closeCartModal","cartModal","refs","renderCartMarkup","getNumberOfProducts","modalImage","onClickDeleteProduct","lsData","getCart","renderCartTpl","countTotalPrice","onOrderFormSubmit","evt","parent","productId","findProduct","_id","saveCart","checkLS","arr","markup","name","img","category","price","size","categoryWithoutUnderscore","icons","deleteProducts","clearCart","totalPrice","acc","quantity","updateCartCount","email","checkOnValidateEmail","productsData","orderData","response","errorData","error"],"mappings":"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"}